name: Vanguard Live Engine

on:
  schedule:
    # å°ç£æ™‚é–“æ™šä¸Š 21:00 = UTC 13:00 (æ¯å¤©åŸ·è¡Œï¼Œå«é€±æœ«ä»¥æ•æ‰ Crypto)
    # é€™æ™‚å€™å°è‚¡å·²æ”¶ç›¤ï¼Œç¾è‚¡ç›¤å‰ï¼Œç¬¦åˆ T+1 ä¸‹å–®é‚è¼¯
    - cron: '0 12 * * *'
  
  # å…è¨±æ‰‹å‹•è§¸ç™¼ (æ–¹ä¾¿æ‚¨éš¨æ™‚æ¸¬è©¦)
  workflow_dispatch:

jobs:
  run-strategy:
    runs-on: ubuntu-latest
    permissions:
      contents: write # å¿…é ˆå…è¨±å¯«å…¥æ¬Šé™ï¼Œæ‰èƒ½ Commit state.json å›å€‰åº«

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install yfinance pandas numpy requests

    - name: Run Vanguard Live Engine
      env:
        LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
        LINE_USER_ID: ${{ secrets.LINE_USER_ID }}
      # åŸ·è¡Œä¸»ç¨‹å¼
      run: "python V181_Omega.py"

    - name: Commit state.json back to repository
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "ğŸ¤– ç³»çµ±æ›´æ–°: å„²å­˜ Vanguard Live æ­·å²æœ€é«˜åƒ¹ç‹€æ…‹"
        file_pattern: state.json
